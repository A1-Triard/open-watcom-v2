proj_name = cpplib

x_subdir = xobjs

additional_cleanup_subdir = $(x_subdir)

# make targets for libraries
#
# source-dependent targets are found in macros:
#   objs_asm:       assembler
#   objs_c:         C
#   objs_cpp:       C++
#
_subdir_ = $(x_subdir)/
xobjs = $+ $(objs_asm) $(objs_c) $(objs_cpp) $-
_subdir_ =
objs = $+ $(objs_asm) $(objs_c) $(objs_cpp) $-
files = $+ $(static_objs) $-

cpp_dirs = ../../cpp
asm_dirs = ../../a;../../inc

!include $(cpplib_dir)/libtarg.mif

!ifeq processor 087
target_lib = $(prefix)7$(suffix).lib
!else ifeq processor 387
target_lib = $(prefix)7$(suffix).lib
!else
target_lib = $(prefix)$(suffix).lib
!endif
!ifneq prefix cmplx
!ifeq processor 087
target_lib_x = $(prefix_x)7$(suffix).lib
!else ifeq processor 387
target_lib_x = $(prefix_x)7$(suffix).lib
!else
target_lib_x = $(prefix_x)$(suffix).lib
!endif
!endif

!include cproj.mif
!include deftarg.mif

!include $(cpplib_dir)/flags.mif

!ifndef target_objs
target_objs = $(objs)
!endif

!ifndef target_xobjs
target_xobjs = $(xobjs)
!endif

libs : .symbolic $(target_lib) $(target_lib_x) $(files)
    @%null

$(target_lib) : $(target_objs) $(__MAKEFILES__)
    $(noecho)%create $^&.lbc
    @for %i in ($(target_objs)) do @%append $^&.lbc +%i
    @%make echo_lib
    $(librarian) $(plib_lib_flags) $^@ @$^&.lbc

!ifdef target_lib_x
$(target_lib_x) : $(target_xobjs) $(__MAKEFILES__)
    $(noecho)%create $^&.lbc
    @for %i in ($(target_xobjs)) do @%append $^&.lbc +%i
    @%make echo_lib
    $(librarian) $(plib_lib_flags) $^@ @$^&.lbc
!endif

.cpp : $(cpp_dirs)

.asm : $(asm_dirs)

!include $(cpplib_dir)/librules.mif
